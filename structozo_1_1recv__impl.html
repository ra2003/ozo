<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OZO 「お象」: ozo::recv_impl&lt; Out, typename &gt; Struct Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OZO 「お象」
   </div>
   <div id="projectbrief">Boost.Asio and libpq based asynchronous PostgreSQL unofficial header-only C++17 client library.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('structozo_1_1recv__impl.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="structozo_1_1recv__impl-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ozo::recv_impl&lt; Out, typename &gt; Struct Template Reference<div class="ingroups"><a class="el" href="group__group-io.html">Input/Output</a> &raquo; <a class="el" href="group__group-io-types.html">Types</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="recv_8h_source.html">ozo/io/recv.h</a>&gt;</code></p>
<a name="details" id="details"></a><h2 class="groupheader">Description</h2>
<div class="textblock"><h3>template&lt;typename Out, typename = std::void_t&lt;&gt;&gt;<br />
struct ozo::recv_impl&lt; Out, typename &gt;</h3>

<p>Defines how to receive an object from an input stream. </p>
<p>This functor is used to deserialize object as query result.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">Out</td><td>&mdash; type of an object to apply to </td></tr>
    <tr><td class="paramname">&lt;anonymous&gt;</td><td>&mdash; SFINAE-based overloading parameter.</td></tr>
  </table>
  </dd>
</dl>
<p>The default implementation uses <code>ozo::read</code> function to deserialize simple objects like integers or strings. For the #DynamicSize objects method <code>resize()</code> will be called. So if your special implementation of #DynamicSize type object does not have such method, you need to specialize this template for the type to resize it to fit the incoming size (see the example below). For the #StaticSize objects size check will be made. In case of incoming size does not equal to value returned by <code><a class="el" href="group__group-io-functions.html#ga282b8dbe9d8b69924f5f38851149808c" title="Returns size of object binary representation in bytes.">ozo::size_of()</a></code> for the object &mdash; <code>std::range_error</code> will be thrown.</p>
<p>To deserialize complex types like <a class="el" href="interface_array.html" title="Array concept represents PostgreSQL array.">Array</a> or <a class="el" href="interface_composite.html" title="Composite concept represents PostgreSQL composite types.">Composite</a> special internal implementations are used.</p>
<dl class="section note"><dt>Note</dt><dd>This functor requires type definition via <a class="el" href="group__group-type__system-mapping.html#ga208f8c018e90a843a873d56cc6acb943" title="Helper macro to define type mapping between C++ type and PostgreSQL type.">OZO_PG_BIND_TYPE</a> or <a class="el" href="group__group-type__system-mapping.html#gaab97efce284cc18ac78a761f840edde1" title="Helper macro to define custom type mapping.">OZO_PG_DEFINE_CUSTOM_TYPE</a>.</dd></dl>
<h3>Customization point</h3>
<p>This template is a customization point for specializing deserialization for user defined types if it can not be obtained via the library. Typically user does not need it.</p>
<h3>Example</h3>
<p>File MyString.h </p><div class="fragment"><div class="line"><span class="keyword">namespace </span>NSdemo {</div>
<div class="line"><span class="comment">// Out string-like class with our own code-style</span></div>
<div class="line"><span class="keyword">class </span>MyString {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line">    SizeType Size() <span class="keyword">const</span>;</div>
<div class="line">    <span class="keywordtype">char</span>* Buffer();</div>
<div class="line">    <span class="keywordtype">void</span> Resize(<a class="code" href="group__group-type__system-types.html#ga1d101b3c4c4956099d1b6db01c5e5a7b">size_type</a> size);</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line">};</div>
<div class="line">} <span class="comment">// namespace NSdemo</span></div>
</div><!-- fragment --><p> File MyStringOzoAdaptor.h </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;A/MyString.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>NSdemo {</div>
<div class="line"><span class="comment">// E.g. size and data can be adapted via the free functions</span></div>
<div class="line"><span class="comment">// in same namespace</span></div>
<div class="line"><span class="keyword">inline</span> <span class="keyword">auto</span> size(<span class="keyword">const</span> MyString&amp; s) { <span class="keywordflow">return</span> s.Size(); }</div>
<div class="line"><span class="keyword">inline</span> <span class="keyword">auto</span> data(<span class="keyword">const</span> MyString&amp; s) { <span class="keywordflow">return</span> s.Buffer(); }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace NSdemo</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// We want to use it for the &#39;text&#39; type</span></div>
<div class="line"><a class="code" href="group__group-type__system-mapping.html#ga37e74e6593b00ce3dfda1213bf4b5724">OZO_PG_DEFINE_TYPE_AND_ARRAY</a>(demo::my_string, <span class="stringliteral">&quot;text&quot;</span>, TEXTOID, TEXTARRAYOID, dynamic_size)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>ozo {</div>
<div class="line"><span class="comment">// Since we do not have resize() method and can not implement it</span></div>
<div class="line"><span class="comment">// we need to specialize ozo::recv_impl template to allocate place</span></div>
<div class="line"><span class="comment">// for the data.</span></div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><span class="keyword">struct </span>recv_impl&lt;NSdemo::MyString&gt; {</div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> O<span class="keywordtype">id</span>Map&gt;</div>
<div class="line">    <span class="keyword">static</span> istream&amp; <a class="code" href="structozo_1_1recv__impl.html#a6fa392a69319afc51405c056f6e2ed53">apply</a>(istream&amp; in, <a class="code" href="group__group-type__system-types.html#ga1d101b3c4c4956099d1b6db01c5e5a7b">size_type</a> size, <span class="keyword">const</span> <a class="code" href="group__group-type__system-concepts.html#ga41fff92f9d5a046bcd0654312352e153">OidMap</a>&amp;, NSdemo::MyString&amp; out) {</div>
<div class="line">        <span class="comment">// Allocating space for info</span></div>
<div class="line">        out.Resize(size);</div>
<div class="line">        <span class="comment">// Reading raw info from the input stream</span></div>
<div class="line">        <span class="keywordflow">return</span> read(in, out);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line">} <span class="comment">// namespace ozo</span></div>
</div><!-- fragment --> </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a6fa392a69319afc51405c056f6e2ed53"><td class="memTemplParams" colspan="2">template&lt;typename OidMap &gt; </td></tr>
<tr class="memitem:a6fa392a69319afc51405c056f6e2ed53"><td class="memTemplItemLeft" align="right" valign="top">static istream &amp;&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structozo_1_1recv__impl.html#a6fa392a69319afc51405c056f6e2ed53">apply</a> (istream &amp;in, <a class="el" href="group__group-type__system-types.html#ga1d101b3c4c4956099d1b6db01c5e5a7b">size_type</a> size, const OidMap &amp;, Out &amp;out)</td></tr>
<tr class="memdesc:a6fa392a69319afc51405c056f6e2ed53"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implementation of deserialization object from a stream.  <a href="structozo_1_1recv__impl.html#a6fa392a69319afc51405c056f6e2ed53">More...</a><br /></td></tr>
<tr class="separator:a6fa392a69319afc51405c056f6e2ed53"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a6fa392a69319afc51405c056f6e2ed53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fa392a69319afc51405c056f6e2ed53">&#9670;&nbsp;</a></span>apply()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Out , typename  = std::void_t&lt;&gt;&gt; </div>
<div class="memtemplate">
template&lt;typename OidMap &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static istream&amp; <a class="el" href="structozo_1_1recv__impl.html">ozo::recv_impl</a>&lt; Out, typename &gt;::apply </td>
          <td>(</td>
          <td class="paramtype">istream &amp;&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__group-type__system-types.html#ga1d101b3c4c4956099d1b6db01c5e5a7b">size_type</a>&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const OidMap &amp;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Out &amp;&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implementation of deserialization object from a stream. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">in</td><td>&mdash; input stream </td></tr>
    <tr><td class="paramname">size</td><td>&mdash; size of incoming data </td></tr>
    <tr><td class="paramname">OidMap</td><td>&mdash; #OidMap to get oid for custom types </td></tr>
    <tr><td class="paramname">out</td><td>&mdash; object to deserialize </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ostream&amp; &mdash; input stream </dd></dl>

<p class="reference">References <a class="el" href="group__group-errors-errors.html#ggac6082be94aa8b21e440cab09413a91aca1aa4d64d96113bb92e739e35b6569d63">ozo::error::bad_object_size</a>, and <a class="el" href="group__group-io-functions.html#ga282b8dbe9d8b69924f5f38851149808c">ozo::size_of()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astructozo_1_1recv__impl_html_a6fa392a69319afc51405c056f6e2ed53"><div class="ttname"><a href="structozo_1_1recv__impl.html#a6fa392a69319afc51405c056f6e2ed53">ozo::recv_impl::apply</a></div><div class="ttdeci">static istream &amp; apply(istream &amp;in, size_type size, const OidMap &amp;, Out &amp;out)</div><div class="ttdoc">Implementation of deserialization object from a stream.</div><div class="ttdef"><b>Definition:</b> recv.h:89</div></div>
<div class="ttc" id="agroup__group-type__system-concepts_html_ga41fff92f9d5a046bcd0654312352e153"><div class="ttname"><a href="group__group-type__system-concepts.html#ga41fff92f9d5a046bcd0654312352e153">ozo::OidMap</a></div><div class="ttdeci">constexpr auto OidMap</div><div class="ttdoc">Map of C++ types to corresponding PostgreSQL types OIDs.</div><div class="ttdef"><b>Definition:</b> type_traits.h:534</div></div>
<div class="ttc" id="agroup__group-type__system-types_html_ga1d101b3c4c4956099d1b6db01c5e5a7b"><div class="ttname"><a href="group__group-type__system-types.html#ga1d101b3c4c4956099d1b6db01c5e5a7b">ozo::size_type</a></div><div class="ttdeci">std::int32_t size_type</div><div class="ttdoc">PostgreSQL size type.</div><div class="ttdef"><b>Definition:</b> type_traits.h:265</div></div>
<div class="ttc" id="agroup__group-type__system-mapping_html_ga37e74e6593b00ce3dfda1213bf4b5724"><div class="ttname"><a href="group__group-type__system-mapping.html#ga37e74e6593b00ce3dfda1213bf4b5724">OZO_PG_DEFINE_TYPE_AND_ARRAY</a></div><div class="ttdeci">#define OZO_PG_DEFINE_TYPE_AND_ARRAY(Type, Name, Oid, ArrayOid, Size)</div><div class="ttdoc">[[DEPRECATED]] Helper macro to define type mapping</div><div class="ttdef"><b>Definition:</b> type_traits.h:415</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>ozo</b></li><li class="navelem"><a class="el" href="structozo_1_1recv__impl.html">recv_impl</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
