<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OZO 「お象」: Strategy interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OZO 「お象」
   </div>
   <div id="projectbrief">Boost.Asio and libpq based asynchronous PostgreSQL unofficial header-only C++17 client library.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__group-failover-strategy.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Strategy interface<div class="ingroups"><a class="el" href="group__group-failover.html">Failover</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Description</h2>
<p>Failover microframwork strategy extention interface. </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structozo_1_1failover_1_1basic__context.html">ozo::failover::basic_context&lt; ConnectionProvider, TimeConstraint, Args &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Basic operation context.  <a href="structozo_1_1failover_1_1basic__context.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga9309394db4482d2cb60e17bf08e4d5ca"><td class="memTemplParams" colspan="2">template&lt;typename FailoverStrategy , typename Operation , typename Allocator , typename ... Args&gt; </td></tr>
<tr class="memitem:ga9309394db4482d2cb60e17bf08e4d5ca"><td class="memTemplItemLeft" align="right" valign="top">auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__group-failover-strategy.html#ga9309394db4482d2cb60e17bf08e4d5ca">ozo::failover::get_first_try</a> (const Operation &amp;op, const FailoverStrategy &amp;strategy, const Allocator &amp;alloc, Args &amp;&amp;...args)</td></tr>
<tr class="memdesc:ga9309394db4482d2cb60e17bf08e4d5ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the first try object for an operation.  <a href="group__group-failover-strategy.html#ga9309394db4482d2cb60e17bf08e4d5ca">More...</a><br /></td></tr>
<tr class="separator:ga9309394db4482d2cb60e17bf08e4d5ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabad7337ad251d38a1f1c39acd4ed37a4"><td class="memTemplParams" colspan="2">template&lt;typename FailoverTry &gt; </td></tr>
<tr class="memitem:gabad7337ad251d38a1f1c39acd4ed37a4"><td class="memTemplItemLeft" align="right" valign="top">auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__group-failover-strategy.html#gabad7337ad251d38a1f1c39acd4ed37a4">ozo::failover::get_try_context</a> (const FailoverTry &amp;a_try)</td></tr>
<tr class="memdesc:gabad7337ad251d38a1f1c39acd4ed37a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get operation context for the try.  <a href="group__group-failover-strategy.html#gabad7337ad251d38a1f1c39acd4ed37a4">More...</a><br /></td></tr>
<tr class="separator:gabad7337ad251d38a1f1c39acd4ed37a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga389bc19389a8f5a00922c70abb589914"><td class="memTemplParams" colspan="2">template&lt;typename Try , typename Connection &gt; </td></tr>
<tr class="memitem:ga389bc19389a8f5a00922c70abb589914"><td class="memTemplItemLeft" align="right" valign="top">auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__group-failover-strategy.html#ga389bc19389a8f5a00922c70abb589914">ozo::failover::get_next_try</a> (Try &amp;a_try, const <a class="el" href="group__group-errors.html#ga8757df037905ea8c9b69073e350dd731">error_code</a> &amp;ec, <a class="el" href="interface_connection.html">Connection</a> &amp;conn)</td></tr>
<tr class="memdesc:ga389bc19389a8f5a00922c70abb589914"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the next try object.  <a href="group__group-failover-strategy.html#ga389bc19389a8f5a00922c70abb589914">More...</a><br /></td></tr>
<tr class="separator:ga389bc19389a8f5a00922c70abb589914"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7873c9e111e39faa994a277d6c488c32"><td class="memTemplParams" colspan="2">template&lt;typename Try , typename Connection , typename Initiator &gt; </td></tr>
<tr class="memitem:ga7873c9e111e39faa994a277d6c488c32"><td class="memTemplItemLeft" align="right" valign="top">auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__group-failover-strategy.html#ga7873c9e111e39faa994a277d6c488c32">ozo::failover::initiate_next_try</a> (Try &amp;a_try, const <a class="el" href="group__group-errors.html#ga8757df037905ea8c9b69073e350dd731">error_code</a> &amp;ec, <a class="el" href="interface_connection.html">Connection</a> &amp;conn, Initiator &amp;&amp;init)</td></tr>
<tr class="memdesc:ga7873c9e111e39faa994a277d6c488c32"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiates the next try of an operation execution.  <a href="group__group-failover-strategy.html#ga7873c9e111e39faa994a277d6c488c32">More...</a><br /></td></tr>
<tr class="separator:ga7873c9e111e39faa994a277d6c488c32"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:gac2afab6d73cef820f49c8559cec5f956"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:gac2afab6d73cef820f49c8559cec5f956"><td class="memTemplItemLeft" align="right" valign="top">constexpr auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__group-failover-strategy.html#gac2afab6d73cef820f49c8559cec5f956">ozo::FailoverStrategy</a></td></tr>
<tr class="memdesc:gac2afab6d73cef820f49c8559cec5f956"><td class="mdescLeft">&#160;</td><td class="mdescRight">FailoverStrategy concept.  <a href="group__group-failover-strategy.html#gac2afab6d73cef820f49c8559cec5f956">More...</a><br /></td></tr>
<tr class="separator:gac2afab6d73cef820f49c8559cec5f956"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeac8bb031ba621fe5186f308f68d3944"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:gaeac8bb031ba621fe5186f308f68d3944"><td class="memTemplItemLeft" align="right" valign="top">constexpr auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__group-failover-strategy.html#gaeac8bb031ba621fe5186f308f68d3944">ozo::FailoverTry</a></td></tr>
<tr class="memdesc:gaeac8bb031ba621fe5186f308f68d3944"><td class="mdescLeft">&#160;</td><td class="mdescRight">FailoverTry concept.  <a href="group__group-failover-strategy.html#gaeac8bb031ba621fe5186f308f68d3944">More...</a><br /></td></tr>
<tr class="separator:gaeac8bb031ba621fe5186f308f68d3944"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga9309394db4482d2cb60e17bf08e4d5ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9309394db4482d2cb60e17bf08e4d5ca">&#9670;&nbsp;</a></span>get_first_try()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename FailoverStrategy , typename Operation , typename Allocator , typename ... Args&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">auto ozo::failover::get_first_try </td>
          <td>(</td>
          <td class="paramtype">const Operation &amp;&#160;</td>
          <td class="paramname"><em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const FailoverStrategy &amp;&#160;</td>
          <td class="paramname"><em>strategy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Allocator &amp;&#160;</td>
          <td class="paramname"><em>alloc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Args &amp;&amp;...&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the first try object for an operation. </p>
<p>This function is a part of failover strategy interface. It creates the first try of operation execution context. The context data should be allocated via the specified allocator. This function would be called once during a failover operation execution. By default #FailoverStrategy should have <code>get_first_try(const Operation&amp; op, const Allocator&amp; alloc, Args&amp;&amp; ...args) const</code> member function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">op</td><td>&mdash; operation for which the try object should be created. </td></tr>
    <tr><td class="paramname">strategy</td><td>&mdash; strategy according to which the try object should be created. </td></tr>
    <tr><td class="paramname">alloc</td><td>&mdash; allocator for try object. </td></tr>
    <tr><td class="paramname">args</td><td>&mdash; operation arguments except <a class="el" href="interface_completion_token.html" title="Completion token concept.">CompletionToken</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>#FailoverTry object.</dd></dl>
<h3>Customization Point</h3>
<p>This function may be customized for a #FailoverStrategy via specialization of <code>ozo::failover::get_first_try_impl</code>. E.g.: </p><div class="fragment"><div class="line"><span class="keyword">namespace </span>ozo::failover {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Operation&gt;</div>
<div class="line"><span class="keyword">struct </span>get_first_try_impl&lt;my_strategy, Operation&gt; {</div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Allocator, <span class="keyword">typename</span> ...Args&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">auto</span> apply(<span class="keyword">const</span> Operation&amp;, <span class="keyword">const</span> my_strategy&amp; s, <span class="keyword">const</span> Allocator&amp; alloc, Args&amp;&amp; ...args) {</div>
<div class="line">        <span class="keywordflow">return</span> s.get_start_context&lt;Operation&gt;(alloc, std::forward&lt;Args&gt;(args)...);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace ozo::failover</span></div>
</div><!-- fragment --> 
</div>
</div>
<a id="ga389bc19389a8f5a00922c70abb589914"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga389bc19389a8f5a00922c70abb589914">&#9670;&nbsp;</a></span>get_next_try()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Try , typename Connection &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">auto ozo::failover::get_next_try </td>
          <td>(</td>
          <td class="paramtype">Try &amp;&#160;</td>
          <td class="paramname"><em>a_try</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__group-errors.html#ga8757df037905ea8c9b69073e350dd731">error_code</a> &amp;&#160;</td>
          <td class="paramname"><em>ec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interface_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the next try object. </p>
<p>Return #FailoverTry for next failover try if it possible. By default it calls <code>a_try.get_next_try(ec, conn)</code>. This behavior customisable via <code>ozo::failover::get_next_try_impl</code> specialization. It will be used by default if no <code>ozo::failover::initiate_next_try</code> customization had been made.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a_try</td><td>&mdash; current #FailoverTry object. </td></tr>
    <tr><td class="paramname">ec</td><td>&mdash; current try error code. </td></tr>
    <tr><td class="paramname">conn</td><td>&mdash; current #connection object. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>#FailoverTry &mdash; if given error code and connection may be failovered with next try. </dd>
<dd>
null-state &mdash; otherwise.</dd></dl>
<h3>Customization Point</h3>
<p>This function may be customized for a #FailoverTry via specialization of <code>ozo::failover::get_next_try_impl</code>. E.g.: </p><div class="fragment"><div class="line"><span class="keyword">namespace </span>ozo::failover {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><span class="keyword">struct </span>get_next_try_impl&lt;my_strategy_try&gt; {</div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Allocator, <span class="keyword">typename</span> ...Args&gt;</div>
<div class="line">    <span class="keyword">static</span> std::optional&lt;my_strategy_try&gt; apply(<span class="keyword">const</span> my_strategy_try&amp; obj, <a class="code" href="group__group-errors.html#ga8757df037905ea8c9b69073e350dd731">error_code</a> ec, Conn&amp;&amp; conn) {</div>
<div class="line">        <span class="keywordflow">if</span> (ec != my_error_condition::recoverable) {</div>
<div class="line">            obj.log_error(<span class="stringliteral">&quot;can not recover error {0} with message {1}&quot;</span>, ec, <a class="code" href="group__group-connection-functions.html#gad1d7e52e998faef0eb5ea3767ca1ca70">ozo::error_message</a>(conn));</div>
<div class="line">            <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line">        }</div>
<div class="line">        obj.log_notice(<span class="stringliteral">&quot;recovering error {0} with message {1}&quot;</span>, ec, <a class="code" href="group__group-connection-functions.html#gad1d7e52e998faef0eb5ea3767ca1ca70">ozo::error_message</a>(conn));</div>
<div class="line">        <span class="keywordflow">return</span> obj;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace ozo::failover</span></div>
</div><!-- fragment --> 
<p class="reference">References <a class="el" href="group__group-core-functions.html#gacfad17554992a1f9e9bfe9d92854b743">ozo::unwrap()</a>.</p>

</div>
</div>
<a id="gabad7337ad251d38a1f1c39acd4ed37a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabad7337ad251d38a1f1c39acd4ed37a4">&#9670;&nbsp;</a></span>get_try_context()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename FailoverTry &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">auto ozo::failover::get_try_context </td>
          <td>(</td>
          <td class="paramtype">const FailoverTry &amp;&#160;</td>
          <td class="paramname"><em>a_try</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get operation context for the try. </p>
<p>By default #FailoverTry object should have <code>get_context() const</code> member function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a_try</td><td>&mdash; #FailoverTry object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>auto &mdash; #HanaSequence with operation arguments.</dd></dl>
<h3>Customization Point</h3>
<p>This function may be customized for a #FailoverTry via specialization of <code>ozo::failover::get_try_context_impl</code>. E.g.: </p><div class="fragment"><div class="line"><span class="keyword">namespace </span>ozo::failover {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><span class="keyword">struct </span>get_try_context_impl&lt;my_strategy_try&gt; {</div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Allocator, <span class="keyword">typename</span> ...Args&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">auto</span> apply(<span class="keyword">const</span> my_strategy_try&amp; obj) {</div>
<div class="line">        <span class="keywordflow">return</span> obj.ctx;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace ozo::failover</span></div>
</div><!-- fragment --> 
<p class="reference">References <a class="el" href="group__group-core-functions.html#gacfad17554992a1f9e9bfe9d92854b743">ozo::unwrap()</a>.</p>

</div>
</div>
<a id="ga7873c9e111e39faa994a277d6c488c32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7873c9e111e39faa994a277d6c488c32">&#9670;&nbsp;</a></span>initiate_next_try()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Try , typename Connection , typename Initiator &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">auto ozo::failover::initiate_next_try </td>
          <td>(</td>
          <td class="paramtype">Try &amp;&#160;</td>
          <td class="paramname"><em>a_try</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__group-errors.html#ga8757df037905ea8c9b69073e350dd731">error_code</a> &amp;&#160;</td>
          <td class="paramname"><em>ec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interface_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Initiator &amp;&amp;&#160;</td>
          <td class="paramname"><em>init</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initiates the next try of an operation execution. </p>
<p>This mechanism supports static polymorphism of tries depended on error conditions. Unlike <code><a class="el" href="group__group-failover-strategy.html#ga389bc19389a8f5a00922c70abb589914" title="Get the next try object.">ozo::failover::get_next_try()</a></code> it allows to use different types of try-objects for different error conditions.</p>
<p>Function implementation should call initiator in case of operation with given error condition may be recovered by try-object is given to initiator. Or should not call initiator in case of an unrecoverable error condition.</p>
<dl class="section note"><dt>Note</dt><dd>Initiator object should be called only once and should not be called out of the function scope since it contains references on stack-allocated objects.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a_try</td><td>&mdash; current #FailoverTry object. </td></tr>
    <tr><td class="paramname">ec</td><td>&mdash; current try error code. </td></tr>
    <tr><td class="paramname">conn</td><td>&mdash; current #connection object. </td></tr>
    <tr><td class="paramname">init</td><td>&mdash; initiator of an operation execution, functional object with signature <code>void(auto try)</code></td></tr>
  </table>
  </dd>
</dl>
<h3>Customization Point</h3>
<p>This function may be customized for a #FailoverTry via specialization of <code>ozo::failover::initiate_next_try_impl</code>. E.g. default implementation may look like this: </p><div class="fragment"><div class="line"><span class="keyword">namespace </span>ozo::failover {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Try&gt;</div>
<div class="line"><span class="keyword">struct </span>initiate_next_try_impl {</div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Connection, <span class="keyword">typename</span> Initiator&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">auto</span> apply(Try&amp; a_try, <span class="keyword">const</span> <a class="code" href="group__group-errors.html#ga8757df037905ea8c9b69073e350dd731">error_code</a>&amp; ec, <a class="code" href="interface_connection.html">Connection</a>&amp; conn, Initiator init) {</div>
<div class="line">        <span class="keywordflow">if</span> (<span class="keyword">auto</span> next = <a class="code" href="group__group-failover-strategy.html#ga389bc19389a8f5a00922c70abb589914">get_next_try</a>(a_try, ec, conn); !<a class="code" href="group__group-core-functions.html#ga730b6174c7f8beb62c3d84616d936dc1">is_null</a>(next)) {</div>
<div class="line">            init(std::move(next));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace ozo::failover</span></div>
</div><!-- fragment --> 
<p class="reference">References <a class="el" href="group__group-core-functions.html#gacfad17554992a1f9e9bfe9d92854b743">ozo::unwrap()</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="gac2afab6d73cef820f49c8559cec5f956"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac2afab6d73cef820f49c8559cec5f956">&#9670;&nbsp;</a></span>FailoverStrategy</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr auto ozo::FailoverStrategy</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>FailoverStrategy concept. </p>
<p>Failover strategy defines interface for the failover framework extention. <code>FailoverStrategy</code> should be a factory for the first #FailoverTry.</p>
<h3>Failover Compatible Operation</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;boost/asio/spawn.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>complex_transaction_data {</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Initiator&gt;</div>
<div class="line"><span class="keyword">struct </span>complex_transaction_op : base_async_operation &lt;complex_transaction_op, Initiator&gt; {</div>
<div class="line">    <span class="keyword">using</span> base = <span class="keyword">typename</span> complex_transaction_op::base;</div>
<div class="line">    <span class="keyword">using</span> base::base;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> P, <span class="keyword">typename</span> TimeConstra<span class="keywordtype">int</span>, <span class="keyword">typename</span> CompletionToken&gt;</div>
<div class="line">    decltype(<span class="keyword">auto</span>) operator() (P&amp;&amp; provider, complex_transaction_data data, TimeConstraint t, <a class="code" href="interface_completion_token.html">CompletionToken</a>&amp;&amp; token)<span class="keyword"> const </span>{</div>
<div class="line">        static_assert(ozo::ConnectionProvider&lt;P&gt;, <span class="stringliteral">&quot;provider should be a ConnectionProvider&quot;</span>);</div>
<div class="line">        static_assert(ozo::TimeConstraint&lt;TimeConstraint&gt;, <span class="stringliteral">&quot;should model TimeConstraint concept&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> ozo::async_initiate&lt;CompletionToken, ozo::handler_signature&lt;P&gt;&gt;(</div>
<div class="line">            <span class="comment">// Initiator and token</span></div>
<div class="line">            <a class="code" href="group__group-core-functions.html#gafcdc8ea45e26815baaeebfa88313cd23">get_operation_initiator</a>(*<span class="keyword">this</span>), token,</div>
<div class="line">            <span class="comment">// ConnectionProvider, TimeConstraint, additional arguments</span></div>
<div class="line">            std::forward&lt;P&gt;(provider), <a class="code" href="group__group-core-functions.html#gaef210c4fa15eeba34058ddadca2aa4e2">ozo::deadline</a>(t), std::move(data)</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>detail {</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Handler, <span class="keyword">typename</span> TimeConstra<span class="keywordtype">int</span>&gt;</div>
<div class="line"><span class="keyword">struct </span>complex_transaction_impl {</div>
<div class="line">    complex_transaction_data data_;</div>
<div class="line">    TimeConstraint time_constraint_;</div>
<div class="line">    <a class="code" href="interface_handler.html">Handler</a> handler_;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Connection&gt;</div>
<div class="line">    constexpr <span class="keywordtype">void</span> operator()(<a class="code" href="group__group-errors.html#ga8757df037905ea8c9b69073e350dd731">error_code</a> ec, <a class="code" href="interface_connection.html">Connection</a>&amp;&amp; conn) {</div>
<div class="line">        <span class="keywordflow">if</span> (ec) {</div>
<div class="line">            <span class="keywordflow">return</span> handler_(ec, std::forward&lt;Connection&gt;(conn));</div>
<div class="line">        }</div>
<div class="line">        boost::asio::spawn(<a class="code" href="group__group-connection-functions.html#ga4c99d8eedbda009b5ec1783ecc1b8073">ozo::get_executor</a>(conn), [</div>
<div class="line">                data = std::move(data_),</div>
<div class="line">                time_constraint = std::move(time_constraint_),</div>
<div class="line">                handler = std::move(handler_)] (<span class="keyword">auto</span> yield) <span class="keyword">mutable</span> {</div>
<div class="line">            <a class="code" href="group__group-errors.html#ga8757df037905ea8c9b69073e350dd731">error_code</a> ec;</div>
<div class="line">            <a class="code" href="group__group-requests-types.html#gade9a42efa5064524382c2673de242f39">ozo::rows_of</a>&lt;...&gt; rows;</div>
<div class="line">            <span class="keyword">auto</span> conn = <a class="code" href="group__group-requests-functions.html#gac093ec8cf86103a3588072066767c418">ozo::request</a>(conn, time_constraint_, <span class="stringliteral">&quot;...&quot;</span>_SQL..., <a class="code" href="group__group-requests-functions.html#ga3e8f5ef58a370e79b7e554cd09fbc705">ozo::into</a>(rows), yield[ec]);</div>
<div class="line">            <span class="keywordflow">if</span> (!ec) {</div>
<div class="line">                conn = <a class="code" href="group__group-requests-functions.html#ga347747678f21ede443893c1a0a9439d7">ozo::execute</a>(conn, time_constraint_, <span class="stringliteral">&quot;...&quot;</span>_SQL + handle_data(rows)..., yield[ec]);</div>
<div class="line">                <span class="keywordflow">if</span> (!ec) {</div>
<div class="line">                    <span class="keywordflow">return</span> ozo::commit(conn, std::move(handler_));</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keyword">auto</span> ex = boost::asio::get_associated_executor(handler_);</div>
<div class="line">            boost::asio::dispatch(ex, [ec, handler=std::move(handler_), conn = std::move(conn)]{</div>
<div class="line">                handler(ec, std::move(conn));</div>
<div class="line">            });</div>
<div class="line">        });</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> executor_type = decltype(asio::get_associated_executor(handler_));</div>
<div class="line"> </div>
<div class="line">    executor_type <a class="code" href="group__group-connection-functions.html#ga4c99d8eedbda009b5ec1783ecc1b8073">get_executor</a>() const noexcept {</div>
<div class="line">        <span class="keywordflow">return</span> asio::get_associated_executor(handler_);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> allocator_type = decltype(asio::get_associated_allocator(handler_));</div>
<div class="line"> </div>
<div class="line">    allocator_type get_allocator() const noexcept {</div>
<div class="line">        <span class="keywordflow">return</span> asio::get_associated_allocator(handler_);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>initiate_complex_transaction {</div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Handler, <span class="keyword">typename</span> P, <span class="keyword">typename</span> Q, <span class="keyword">typename</span> TimeConstra<span class="keywordtype">int</span>&gt;</div>
<div class="line">    constexpr <span class="keywordtype">void</span> operator()(<a class="code" href="interface_handler.html">Handler</a>&amp;&amp; h, P&amp;&amp; provider, TimeConstraint t, complex_transaction_data data)<span class="keyword"> const </span>{</div>
<div class="line">        ozo::begin(provider, t, complex_transaction_impl{std::move(data), t, std::forward&lt;Handler&gt;(h)});</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line">} <span class="comment">// namespace detail</span></div>
<div class="line"> </div>
<div class="line">constexpr complex_transaction_op&lt;detail::initiate_async_execute&gt; complex_transaction;</div>
</div><!-- fragment --> 
</div>
</div>
<a id="gaeac8bb031ba621fe5186f308f68d3944"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaeac8bb031ba621fe5186f308f68d3944">&#9670;&nbsp;</a></span>FailoverTry</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr auto ozo::FailoverTry</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>FailoverTry concept. </p>
<p>Failover try defines interface for a single operation execution try and possible next failover try. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__group-requests-functions_html_gac093ec8cf86103a3588072066767c418"><div class="ttname"><a href="group__group-requests-functions.html#gac093ec8cf86103a3588072066767c418">ozo::request</a></div><div class="ttdeci">decltype(auto) request(ConnectionProvider &amp;&amp;provider, BinaryQueryConvertible &amp;&amp;query, TimeConstraint time_constraint, Out out, CompletionToken &amp;&amp;token)</div><div class="ttdoc">Executes query and retrives a result from a database with time constraint.</div></div>
<div class="ttc" id="agroup__group-errors_html_ga8757df037905ea8c9b69073e350dd731"><div class="ttname"><a href="group__group-errors.html#ga8757df037905ea8c9b69073e350dd731">ozo::error_code</a></div><div class="ttdeci">boost::system::error_code error_code</div><div class="ttdoc">Error code representation of the library.</div><div class="ttdef"><b>Definition:</b> error.h:38</div></div>
<div class="ttc" id="agroup__group-core-functions_html_gaef210c4fa15eeba34058ddadca2aa4e2"><div class="ttname"><a href="group__group-core-functions.html#gaef210c4fa15eeba34058ddadca2aa4e2">ozo::deadline</a></div><div class="ttdeci">constexpr time_traits::time_point deadline(time_traits::time_point t) noexcept</div><div class="ttdoc">Dealdine calculation.</div><div class="ttdef"><b>Definition:</b> deadline.h:16</div></div>
<div class="ttc" id="agroup__group-connection-functions_html_gad1d7e52e998faef0eb5ea3767ca1ca70"><div class="ttname"><a href="group__group-connection-functions.html#gad1d7e52e998faef0eb5ea3767ca1ca70">ozo::error_message</a></div><div class="ttdeci">std::string_view error_message(const Connection &amp;conn)</div><div class="ttdoc">Get native libpq error message.</div><div class="ttdef"><b>Definition:</b> connection.h:97</div></div>
<div class="ttc" id="agroup__group-connection-functions_html_ga4c99d8eedbda009b5ec1783ecc1b8073"><div class="ttname"><a href="group__group-connection-functions.html#ga4c99d8eedbda009b5ec1783ecc1b8073">ozo::get_executor</a></div><div class="ttdeci">auto get_executor(const Connection &amp;conn) noexcept</div><div class="ttdoc">Get the executor associated with the object.</div><div class="ttdef"><b>Definition:</b> connection.h:130</div></div>
<div class="ttc" id="agroup__group-requests-types_html_gade9a42efa5064524382c2673de242f39"><div class="ttname"><a href="group__group-requests-types.html#gade9a42efa5064524382c2673de242f39">ozo::rows_of</a></div><div class="ttdeci">std::vector&lt; typed_row&lt; Ts... &gt; &gt; rows_of</div><div class="ttdoc">Shortcut for easy result container definition.</div><div class="ttdef"><b>Definition:</b> shortcuts.h:37</div></div>
<div class="ttc" id="agroup__group-requests-functions_html_ga3e8f5ef58a370e79b7e554cd09fbc705"><div class="ttname"><a href="group__group-requests-functions.html#ga3e8f5ef58a370e79b7e554cd09fbc705">ozo::into</a></div><div class="ttdeci">constexpr auto into(T &amp;v)</div><div class="ttdoc">Shortcut for create result container back inserter.</div><div class="ttdef"><b>Definition:</b> shortcuts.h:85</div></div>
<div class="ttc" id="agroup__group-requests-functions_html_ga347747678f21ede443893c1a0a9439d7"><div class="ttname"><a href="group__group-requests-functions.html#ga347747678f21ede443893c1a0a9439d7">ozo::execute</a></div><div class="ttdeci">decltype(auto) execute(ConnectionProvider &amp;&amp;provider, BinaryQueryConvertible &amp;&amp;query, TimeConstraint time_constraint, CompletionToken &amp;&amp;token)</div><div class="ttdoc">Executes query with no result data expected.</div></div>
<div class="ttc" id="agroup__group-core-functions_html_gafcdc8ea45e26815baaeebfa88313cd23"><div class="ttname"><a href="group__group-core-functions.html#gafcdc8ea45e26815baaeebfa88313cd23">ozo::get_operation_initiator</a></div><div class="ttdeci">constexpr auto get_operation_initiator(const Operation &amp;op)</div><div class="ttdoc">Get asynchronous operation initiator.</div><div class="ttdef"><b>Definition:</b> asio.h:166</div></div>
<div class="ttc" id="ainterface_completion_token_html"><div class="ttname"><a href="interface_completion_token.html">CompletionToken</a></div><div class="ttdoc">Completion token concept.</div></div>
<div class="ttc" id="ainterface_handler_html"><div class="ttname"><a href="interface_handler.html">Handler</a></div><div class="ttdoc">Handler concept.</div></div>
<div class="ttc" id="agroup__group-core-functions_html_ga730b6174c7f8beb62c3d84616d936dc1"><div class="ttname"><a href="group__group-core-functions.html#ga730b6174c7f8beb62c3d84616d936dc1">ozo::is_null</a></div><div class="ttdeci">constexpr decltype(auto) is_null(const T &amp;v) noexcept(noexcept(is_null_impl&lt; T &gt;::apply(v)))</div><div class="ttdoc">Indicates if value is in null state.</div><div class="ttdef"><b>Definition:</b> nullable.h:85</div></div>
<div class="ttc" id="agroup__group-failover-strategy_html_ga389bc19389a8f5a00922c70abb589914"><div class="ttname"><a href="group__group-failover-strategy.html#ga389bc19389a8f5a00922c70abb589914">ozo::failover::get_next_try</a></div><div class="ttdeci">auto get_next_try(Try &amp;a_try, const error_code &amp;ec, Connection &amp;conn)</div><div class="ttdoc">Get the next try object.</div><div class="ttdef"><b>Definition:</b> strategy.h:306</div></div>
<div class="ttc" id="ainterface_connection_html"><div class="ttname"><a href="interface_connection.html">Connection</a></div><div class="ttdoc">Database connection concept.</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
